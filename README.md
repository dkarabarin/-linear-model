# Прогнозирование продуктивности и качества молока у коров

## Описание проекта

Фермерское хозяйство «Вольный луг» планирует закупку коров у поставщика «ЭкоФерма». Для минимизации рисков и принятия обоснованных решений необходимо разработать систему прогнозирования, которая поможет отобрать коров по двум ключевым критериям:

1. **Продуктивность**: Удой должен составлять не менее 6000 кг в год
2. **Качество молока**: Молоко должно быть вкусным

**Цель проекта**: Разработать две прогнозные модели:
- **Модель 1**: Линейная регрессия для прогнозирования годового удоя
- **Модель 2**: Логистическая регрессия для прогнозирования вкуса молока

## Данные

Проект использует три источника данных:

### 1. ferma_main.csv (основные данные о коровах, 634 записи)
- `id` — идентификатор коровы
- `удой,_кг` — годовой удой (целевая переменная для регрессии)
- `эке_(энергетическая_кормовая_единица)` — энергетическая ценность корма
- `сырой_протеин,_г` — содержание протеина в корме
- `спо_(сахаро_протеиновое_соотношение)` — соотношение сахара и протеина
- `порода` — порода коровы
- `тип_пастбища` — тип используемого пастбища
- `порода_папы_быка` — порода отца
- `жирность,%` — жирность молока
- `белок,%` — содержание белка в молоке
- `вкус_молока` — вкус молока (целевая переменная для классификации)
- `возраст` — возраст коровы

### 2. ferma_dad.csv (данные об отцах коров, 629 записей)
- `id` — идентификатор коровы
- `имя_папы` — имя отца коровы

### 3. cow_buy.csv (данные о коровах для покупки, 20 записей)
- `порода`, `тип_пастбища`, `порода_папы_быка`, `имя_папы`
- `текущая_жирность,%`, `текущий_уровень_белок,%`
- `возраст`

## Методология

### 1. Предобработка данных
- Приведение названий столбцов к нижнему регистру
- Исправление типов данных (запятые на точки, преобразование в float)
- Обработка дубликатов:
  - Удалено 5 полных дубликатов в ferma_main
  - Удалено 5 дубликатов в cow_buy
- Исправление неявных дубликатов:
  - `Равнинные` → `Равнинное`
  - `Айдиалл` → `Айдиал`

### 2. Исследовательский анализ
- Анализ распределения количественных признаков
- Выявление и обработка выбросов (удалена запись с удоем 45500 кг)
- Анализ категориальных признаков
- Корреляционный анализ

### 3. Подготовка признаков
Для модели линейной регрессии:
- Бинаризация СПО (порог 0.9)
- Добавление квадратичного признака ЭКЕ
- Добавление отношения жирности к белку

### 4. Разделение данных
- Тренировочная выборка: 75%
- Тестовая выборка: 25%
- Random State: 42

## Результаты

### Модель 1: Линейная регрессия (прогноз удоя)

**Лучшая модель** включает:
- Категориальные признаки: `порода`, `порода_папы_быка`, `возраст`, `имя_папы`, `спо_бинарный`
- Количественные признаки: `эке_квадрат`, `жирность,%`, `сырой_протеин,_г`

**Метрики на тестовой выборке**:
- R²: 0.820
- MSE: 36575.96
- MAE: 148.74 кг
- RMSE: 191.25 кг

**Доверительный интервал прогноза**: [-342.39, 378.52] кг

### Модель 2: Логистическая регрессия (прогноз вкуса молока)

**Исходные метрики (порог 0.5)**:
- Accuracy: 0.592
- Precision: 0.598
- Recall: 0.830

**Оптимизация для минимизации рисков**:
- Установлен порог классификации: 0.77
- Новые метрики:
  - Precision: 0.950 (увеличение на 59%)
  - Recall: 0.216

**Особенность**: Высокий Precision минимизирует риск покупки коров с невкусным молоком

## Рекомендации по закупке

### Безрисковая стратегия (2 коровы)
Коровы, удовлетворяющие всем критериям с запасом:

| № | Порода | Тип пастбища | Порода отца | Имя отца | Возраст | Прогноз удоя | Нижняя граница | Вкус молока |
|---|--------|--------------|-------------|----------|---------|--------------|----------------|-------------|
| 3 | РефлешнСоверинг | холмистое | Айдиал | Буйный | более_2_лет | 6527 кг | 6185 кг | ✅ вкусно |
| 15 | РефлешнСоверинг | холмистое | Айдиал | Буйный | более_2_лет | 6527 кг | 6185 кг | ✅ вкусно |

### Умеренно-рисковая стратегия (4 коровы)
Дополнительно можно рассмотреть:

| № | Порода | Прогноз удоя | Нижняя граница | Вкус молока | Риск |
|---|--------|--------------|----------------|-------------|------|
| 10 | Вис Бик Айдиал | 6320 кг | 5978 кг | ✅ вкусно | Удой близок к границе |
| 16 | Вис Бик Айдиал | 6320 кг | 5978 кг | ✅ вкусно | Удой близок к границе |

## Ключевые факторы влияния

### На удой (в порядке важности):
1. **ЭКЕ (энергетическая ценность корма)** — квадратичная зависимость
2. **СПО (сахаро-протеиновое соотношение)** — бинарный порог 0.9
3. **Жирность молока** — положительная корреляция
4. **Возраст** — коровы старше 2 лет более продуктивны
5. **Порода отца** — Айдиал дает более высокий удой

### На вкус молока:
1. **Соотношение жирность/белок** — оптимальное значение ~1.1
2. **Порода** — РефлешнСоверинг чаще дает вкусное молоко
3. **Тип пастбища** — холмистые пастбища предпочтительнее
4. **Имя отца** — Буйный и Соловчик дают потомство с лучшим вкусом молока

## Ограничения и риски

### Ограничения данных:
1. **Несбалансированность по возрасту**: Мало данных по коровам младше 2 лет
2. **Ограниченный объем**: 629 записей для обучения моделей
3. **Отсутствие некоторых параметров**: Нет данных о здоровье, условиях содержания

### Риски прогнозирования:
1. **Доверительный интервал удоя**: ±360 кг
2. **Точность прогноза вкуса**: 95% при пороге 0.77 (но низкий recall)
3. **Внешние факторы**: Погода, болезни, стресс не учтены в моделях

## Рекомендации для фермера

### Стратегия закупки:
1. **Приоритет**: Коровы №3 и №15 — минимальный риск
2. **Альтернатива**: Коровы №10 и №16 — умеренный риск по удою
3. **Отказ**: Остальные 16 коров не соответствуют критериям

### Рекомендации по содержанию:
1. **Кормление**: Поддерживать ЭКЕ на уровне 15.3 ед.
2. **Соотношение**: Контролировать СПО выше 0.9
3. **Селекция**: Отдавать предпочтение быкам Айдиал и Буйный

### Мониторинг:
1. **Первые 3 месяца**: Контроль фактического удоя
2. **Качество молока**: Дегустационные пробы
3. **Корректировка моделей**: Обновление на новых данных

## Техническая реализация

### Используемые технологии:
- **Python 3.9+**
- **Pandas, NumPy** — обработка данных
- **Scikit-learn** — машинное обучение
- **Matplotlib, Seaborn** — визуализация

### Ключевые этапы:
1. Объединение данных из трех источников
2. Feature engineering (бинарные и квадратичные признаки)
3. Обучение и оптимизация моделей
4. Прогнозирование для новых коров
5. Формирование рекомендаций

## Структура проекта
cow_productivity_prediction/
├── data/
│ ├── ferma_main.csv
│ ├── ferma_dad.csv
│ └── cow_buy.csv
├── notebooks/
│ └── cow_analysis.ipynb
├── models/
│ ├── yield_model.pkl
│ └── taste_model.pkl
├── reports/
│ └── purchase_recommendations.pdf
└── README.md

## Установка и запуск

```bash
# Установка зависимостей
pip install pandas numpy scikit-learn matplotlib seaborn

# Запуск анализа
jupyter notebook cow_analysis.ipynb
